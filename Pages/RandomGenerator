import React, { useState, useEffect } from "react";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Badge } from "@/components/ui/badge";
import { 
  Dice1, Dice2, Dice3, Dice4, Dice5, Dice6,
  Shuffle, 
  User, 
  MapPin, 
  Gem, 
  Swords,
  Castle,
  Heart,
  Zap,
  Scroll,
  Copy,
  RefreshCw,
  Sparkles,
  Cloud,
  Crown
} from "lucide-react";
import { motion, AnimatePresence } from "framer-motion";

import RandomTableCard from "../components/random-generator/RandomTableCard";
import QuickAdventureGenerator from "../components/random-generator/QuickAdventureGenerator";
import NPCGeneratorCard from "../components/random-generator/NPCGeneratorCard"; // Moved from inline definition
import ResultsHistory from "../components/random-generator/ResultsHistory";


export default function RandomGeneratorPage() {
  const [activeCategory, setActiveCategory] = useState("names");
  const [lastResults, setLastResults] = useState([]);
  const [isRolling, setIsRolling] = useState(false);

  const categories = [
    { id: "names", name: "Nomes", icon: User, color: "blue" },
    { id: "locations", name: "Locais", icon: MapPin, color: "green" },
    { id: "treasures", name: "Tesouros", icon: Gem, color: "purple" },
    { id: "encounters", name: "Encontros", icon: Swords, color: "red" },
    { id: "ruins", name: "Ru√≠nas", icon: Castle, color: "amber" },
    { id: "personalities", name: "Personalidades", icon: Heart, color: "pink" },
    { id: "events", name: "Eventos", icon: Zap, color: "orange" },
    { id: "npcs", name: "NPCs", icon: User, color: "cyan" },
    { id: "weather", name: "Clima", icon: Cloud, color: "gray" },
    { id: "adventures", name: "Aventuras", icon: Scroll, color: "indigo" }
  ];

  const tables = {
    names: {
      name: "Nomes Aleat√≥rios",
      dice: "d100",
      items: [
        { range: "1-10", result: "Humanos Medievais", examples: ["Aldric", "Elira", "Borin", "Kaela", "Durn", "Mira", "Theron", "Sylva", "Roric", "Nessa"] },
        { range: "11-20", result: "An√µes", examples: ["Thorgrim", "Dagnara", "Brokk", "Hilda", "Grimdrak", "Mordrin", "Yurta", "Fargol", "Keldin", "Vora"] },
        { range: "21-30", result: "Elfos", examples: ["Aelar", "Sylwen", "Liriel", "Faedrun", "Nymera", "Calanthor", "Elenya", "Thandor", "Vaelis", "Myraen"] },
        { range: "31-40", result: "Orcs", examples: ["Ghorak", "Zarga", "Murg", "Krul", "Vash", "Drog", "Harka", "Tug", "Zul", "Grakk"] },
        { range: "41-50", result: "Halflings", examples: ["Pip", "Marla", "Tilly", "Bim", "Orla", "Fret", "Nana", "Wex", "Lolly", "Dorn"] },
        { range: "51-60", result: "Tieflings", examples: ["Zevran", "Mavros", "Lilitha", "Kaelum", "Nyx", "Vex", "Sorin", "Myra", "Draven", "Isolde"] },
        { range: "61-70", result: "Gnomos", examples: ["Fizzwick", "Tillywig", "Zonk", "Pip", "Bimble", "Zara", "Quill", "Tink", "Wex", "Glim"] },
        { range: "71-80", result: "Meio-Orcs", examples: ["Gorrak", "Marna", "Drak", "Syla", "Torvak", "Kira", "Harn", "Lura", "Vex", "Brak"] },
        { range: "81-90", result: "Drac√¥nicos", examples: ["Kaaluth", "Zyraxis", "Vormak", "Nhyssra", "Drothar", "Syrax", "Vaeloth", "Kryssa", "Zormun", "Nythar"] },
        { range: "91-100", result: "Fantasia Ex√≥tica", examples: ["Xal'thun", "Veyra", "Korrin", "Zyn", "Mirel", "Tharok", "Lysa", "Drev", "Orlun", "Nyxra"] }
      ]
    },
    locations: {
      name: "Locais Aleat√≥rios",
      dice: "d20",
      items: [
        { range: "1", result: "Vila isolada cercada por p√¢ntanos", description: "Constru√ß√µes de madeira sobre palafitas, neblina constante" },
        { range: "2", result: "Cidade mercantil em cruzamento de estradas", description: "Movimentada, caravanas, pousadas lotadas" },
        { range: "3", result: "Mosteiro nas montanhas nevadas", description: "Paz, biblioteca antiga, monges estudiosos" },
        { range: "4", result: "Ru√≠nas antigas com est√°tuas quebradas", description: "Pedras cobertas de musgo, aura m√≠stica" },
        { range: "5", result: "Aldeia de pescadores em ilha rochosa", description: "Casas simples, barcos coloridos, maresia" },
        { range: "6", result: "Forte abandonado com t√∫neis secretos", description: "Muralhas em ru√≠nas, passagens ocultas" },
        { range: "7", result: "Mercado flutuante em rio largo", description: "Barcos-loja, produtos ex√≥ticos, movimento" },
        { range: "8", result: "Templo enterrado pela areia", description: "Parcialmente soterrado, hier√≥glifos antigos" },
        { range: "9", result: "Floresta encantada com √°rvores sussurrantes", description: "Magia palp√°vel, sons misteriosos, luz filtrada" },
        { range: "10", result: "Cidade subterr√¢nea iluminada por cogumelos", description: "Bioluminesc√™ncia, arquitetura √∫nica, ecos" },
        { range: "11", result: "Col√¥nia penal em ilha maldita", description: "Isolamento, desesperan√ßa, guardas corruptos" },
        { range: "12", result: "Cidade flutuante sustentada por magia", description: "Arquitetura imposs√≠vel, vista panor√¢mica" },
        { range: "13", result: "Aldeia constru√≠da em √°rvore gigante", description: "Casas nas copas, pontes de corda, harmonia natural" },
        { range: "14", result: "Cemit√©rio onde os mortos n√£o descansam", description: "L√°pides antigas, sussurros noturnos, neblina" },
        { range: "15", result: "Minas esquecidas com m√°quinas antigas", description: "Engrenagens enferrujadas, ecos met√°licos" },
        { range: "16", result: "Torre de mago louco", description: "Arquitetura bizarra, experimentos perigosos" },
        { range: "17", result: "Povoado n√¥made em caravanas", description: "Sempre em movimento, culturas diversas" },
        { range: "18", result: "Lago com ilha central e portal subaqu√°tico", description: "√Åguas cristalinas, mist√©rio aqu√°tico" },
        { range: "19", result: "Cidade em ru√≠nas dominada por cultistas", description: "S√≠mbolos sombrios, rituais noturnos" },
        { range: "20", result: "Combine dois locais anteriores!", description: "Role novamente duas vezes e misture os resultados" }
      ]
    },
    treasures: {
      name: "Tesouros Aleat√≥rios",
      dice: "d12",
      items: [
        { range: "1", result: "2d6 √ó 10 PO + objeto sentimental", description: "Anel com inscri√ß√£o, medalh√£o familiar" },
        { range: "2", result: "1d4 gemas (50 PO cada) + mapa rasgado", description: "Gemas variadas, mapa de local misterioso" },
        { range: "3", result: "Arma +1 (ou equivalente m√°gico)", description: "Brilha levemente, corte mais afiado" },
        { range: "4", result: "Armadura leve encantada (+1 CA)", description: "Mais leve que o normal, prote√ß√£o extra" },
        { range: "5", result: "Po√ß√£o de cura (ou 2d4 po√ß√µes menores)", description: "L√≠quido vermelho cintilante" },
        { range: "6", result: "Item m√°gico menor", description: "Anel de saltos, capa da sombra, bota √©lfica" },
        { range: "7", result: "Livro com feiti√ßo raro", description: "Conhecimento arcano ou divino poderoso" },
        { range: "8", result: "J√≥ia amaldi√ßoada", description: "Bela mas atrai esp√≠ritos e desgra√ßas" },
        { range: "9", result: "Ba√∫ com moedas antigas", description: "Metade √© falsa, mas tem valor hist√≥rico" },
        { range: "10", result: "Tesouro escondido: 3d10 √ó 100 PO", description: "Moedas de ouro + est√°tua valiosa" },
        { range: "11", result: "Item de classe espec√≠fica", description: "Amuleto de resist√™ncia, fetiche xam√¢nico" },
        { range: "12", result: "Artefato lend√°rio menor", description: "Espada que fala, chave de portal dimensional" }
      ]
    },
    encounters: {
      name: "Encontros Aleat√≥rios",
      dice: "d10",
      environments: ["Selvagem", "Urbano", "Dungeon"],
      items: [
        { range: "1", wild: "Animal selvagem (lobo, urso)", urban: "Guarda exigindo suborno", dungeon: "Rato gigante" },
        { range: "2", wild: "Druida solit√°rio", urban: "Ladr√£o tentando roubar", dungeon: "Esqueleto ambulante" },
        { range: "3", wild: "Crian√ßa perdida", urban: "Informante com segredo", dungeon: "Fungo venenoso" },
        { range: "4", wild: "Bando de goblins", urban: "Guarda corrupto", dungeon: "Aranha gigante" },
        { range: "5", wild: "Esp√≠rito da natureza", urban: "Nobre em perigo", dungeon: "G√≥lem de pedra" },
        { range: "6", wild: "Ca√ßador de recompensas", urban: "Mercador ilegal", dungeon: "Cultista em ritual" },
        { range: "7", wild: "√Årvore viva (treant jovem)", urban: "Assassino √† procura", dungeon: "Ilus√£o que causa medo" },
        { range: "8", wild: "Besta m√°gica (unic√≥rnio)", urban: "Mendigo que sabe demais", dungeon: "Trilha de sangue fresco" },
        { range: "9", wild: "Ru√≠na com portal ativo", urban: "Guarda com ordens falsas", dungeon: "Sala cheia de ovos" },
        { range: "10", wild: "Evento m√°gico", urban: "Revolta popular", dungeon: "Armadilha complexa ativa" }
      ]
    },
    ruins: {
      name: "Ru√≠nas e Dungeons",
      dice: "d8",
      items: [
        { range: "1", result: "Templo ca√≠do dedicado a deus esquecido", features: "Altar profanado, s√≠mbolos apagados" },
        { range: "2", result: "Catacumbas com t√∫mulos abertos", features: "Ossadas espalhadas, ecos fantasmag√≥ricos" },
        { range: "3", result: "Laborat√≥rio de mago com experimentos", features: "Frascos borbulhantes, criaturas em fuga" },
        { range: "4", result: "Fortaleza de cavaleiros amaldi√ßoados", features: "Armaduras vazias, espadas cravadas" },
        { range: "5", result: "Pris√£o subterr√¢nea com portas quebradas", features: "Celas abertas, correntes enferrujadas" },
        { range: "6", result: "Cidade subterr√¢nea de duergar", features: "Forjas apagadas, m√°quinas paradas" },
        { range: "7", result: "Torre de observa√ß√£o com portal ativo", features: "Vista panor√¢mica, energia crepitante" },
        { range: "8", result: "Minas com m√°quinas autom√°ticas", features: "Engrenagens funcionando sozinhas" }
      ],
      elements: [
        "Escrituras antigas em l√≠ngua perdida",
        "Sala com ilus√£o de sa√≠da (armadilha)",
        "Tesouro vis√≠vel mas protegido",
        "Sobrevivente (prisioneiro, explorador, monstro ferido)"
      ]
    },
    personalities: {
      name: "Personalidades de NPCs",
      dice: "d10",
      items: [
        { range: "1", trait: "Desconfiado", description: "Sempre acha que est√£o mentindo para ele" },
        { range: "2", trait: "Alegre", description: "Canta enquanto trabalha, otimista" },
        { range: "3", trait: "Fan√°tico", description: "Obcecado por sua causa ou divindade" },
        { range: "4", trait: "Covarde", description: "Foge ao menor sinal de perigo" },
        { range: "5", trait: "Honrado", description: "Cumpre sua palavra a qualquer custo" },
        { range: "6", trait: "Ganancioso", description: "Quer ser pago em ouro adiantado" },
        { range: "7", trait: "Melanc√≥lico", description: "Carrega uma perda dolorosa do passado" },
        { range: "8", trait: "Curioso", description: "Faz perguntas demais sobre tudo" },
        { range: "9", trait: "Orgulhoso", description: "Nunca aceita ajuda de ningu√©m" },
        { range: "10", trait: "Leal", description: "Protegeria amigos at√© a morte" }
      ],
      secrets: [
        "Tem um filho escondido em lugar distante",
        "J√° foi criminoso famoso no passado",
        "√â espi√£o secreto de uma guilda poderosa",
        "Tem medo irracional de um lugar espec√≠fico",
        "Possui um item m√°gico roubado",
        "Est√° sendo chantageado por algu√©m"
      ]
    },
    events: {
      name: "Eventos Aleat√≥rios",
      dice: "d10",
      items: [
        { range: "1", event: "Tempestade repentina", effect: "Inunda estradas, apaga fogueiras" },
        { range: "2", event: "Viajante misterioso", effect: "Oferece profecia ou presente estranho" },
        { range: "3", event: "Animal morto no caminho", effect: "Envenenado? Sacrif√≠cio ritual?" },
        { range: "4", event: "Ponte quebrada", effect: "Precisa teste de agilidade ou desvio longo" },
        { range: "5", event: "Crian√ßa entrega bilhete", effect: "Mensagem misteriosa de remetente desconhecido" },
        { range: "6", event: "Eco m√°gico", effect: "Replica o que algu√©m diz, 3 segundos depois" },
        { range: "7", event: "Mem√≥ria falsa coletiva", effect: "Todos lembram algo que n√£o aconteceu" },
        { range: "8", event: "Reconhecimento falso", effect: "PC √© confundido com fugitivo procurado" },
        { range: "9", event: "Item m√°gico dispara sozinho", effect: "Ativa√ß√£o acidental, efeitos imprevis√≠veis" },
        { range: "10", event: "Eclipse tempor√°rio", effect: "Sol desaparece por 1d4 minutos" }
      ]
    },
    npcs: {
      name: "Gerador de NPCs Completos",
      dice: "Multi-dados",
      components: [
        {
          name: "Profiss√£o",
          items: [
            "Ferreiro", "Taverna", "Mercador", "Guarda", "Agricultor", "Pescador", 
            "Artes√£o", "Escriba", "Curandeiro", "Bardo", "Soldado", "Ca√ßador",
            "Ladr√£o", "Nobre", "Sacerdote", "Mago", "Estalajadeiro", "Mineiro",
            "Marinheiro", "Assassino"
          ]
        },
        {
          name: "Apar√™ncia",
          items: [
            "Muito alto e magro", "Baixo e robusto", "Cicatriz vis√≠vel no rosto",
            "Cabelos grisalhos prematuros", "Olhos de cores diferentes", "Tatuagem tribal",
            "Roupas sempre impec√°veis", "Barba longa e tran√ßada", "M√£os calejadas",
            "Sorriso contagiante", "Postura curvada", "J√≥ias chamativas"
          ]
        },
        {
          name: "Motiva√ß√£o",
          items: [
            "Proteger a fam√≠lia", "Buscar vingan√ßa", "Acumular riqueza", "Encontrar a verdade",
            "Servir aos deuses", "Conquistar poder", "Salvar algu√©m querido", "Provar seu valor",
            "Escapar do passado", "Descobrir suas origens"
          ]
        },
        {
          name: "Segredo",
          items: [
            "Era um criminoso famoso", "Tem poderes m√°gicos ocultos", "√â de fam√≠lia nobre decadente",
            "Trabalha para uma organiza√ß√£o secreta", "Possui um artefato poderoso", "Est√° fugindo de d√≠vidas",
            "Tem um irm√£o g√™meo perdido", "Conhece a localiza√ß√£o de um tesouro"
          ]
        }
      ]
    },
    
    weather: {
      name: "Clima e Ambiente",
      dice: "d20",
      items: [
        { range: "1", result: "Sol radiante", description: "Moral alto, vis√£o clara, calor excessivo" },
        { range: "2", result: "Chuva leve", description: "Terreno escorregadio, pegadas vis√≠veis" },
        { range: "3", result: "Tempestade forte", description: "Visibilidade reduzida, barulho alto" },
        { range: "4", result: "Neblina densa", description: "Vis√£o limitada a 3 metros" },
        { range: "5", result: "Vento forte", description: "Dificulta voo e proj√©teis" },
        { range: "6", result: "Neve pesada", description: "Movimento lento, rastros √≥bvios" },
        { range: "7", result: "Granizo", description: "Dano menor, busca por abrigo" },
        { range: "8", result: "Calor extremo", description: "Desidrata√ß√£o r√°pida, fadiga" },
        { range: "9", result: "Frio intenso", description: "Hipotermia, consumo de recursos" },
        { range: "10", result: "Aurora m√°gica", description: "Magia inst√°vel, fen√¥menos estranhos" },
        { range: "11", result: "Eclipse solar", description: "Escurid√£o tempor√°ria, p√¢nico" },
        { range: "12", result: "Chuva de meteoros", description: "Chuva de fogo, press√°gio" },
        { range: "13", result: "Nevasca m√°gica", description: "Neve colorida, efeitos arcanos" },
        { range: "14", result: "Vento susurrante", description: "Vozes no ar, mensagens" },
        { range: "15", result: "Calmaria total", description: "Sil√™ncio absoluto, inquietante" },
        { range: "16", result: "Chuva √°cida", description: "Dano a equipamentos met√°licos" },
        { range: "17", result: "N√©voa venenosa", description: "Teste de resist√™ncia necess√°rio" },
        { range: "18", result: "Tempestade ps√≠quica", description: "Afeta mentes, ilus√µes" },
        { range: "19", result: "Dia eterno", description: "Sol n√£o se p√µe por dias" },
        { range: "20", result: "Noite perp√©tua", description: "Escurid√£o por v√°rios dias" }
      ]
    }
  };

  const rollDice = (sides) => Math.floor(Math.random() * sides) + 1;

  const rollOnTable = async (tableKey) => {
    setIsRolling(true);
    
    // Simulate dice rolling animation
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    const table = tables[tableKey];
    let result;
    
    if (tableKey === "names") {
      const roll = rollDice(100);
      const range = table.items.find(item => {
        const [min, max] = item.range.split('-').map(n => parseInt(n));
        return roll >= min && roll <= (max || min);
      });
      const randomName = range.examples[Math.floor(Math.random() * range.examples.length)];
      result = {
        table: table.name,
        roll: roll,
        range: range.range,
        result: `${range.result}: ${randomName}`,
        timestamp: new Date()
      };
    } else if (tableKey === "encounters") {
      const roll = rollDice(10);
      const environment = ["wild", "urban", "dungeon"][Math.floor(Math.random() * 3)];
      const environmentName = ["Selvagem", "Urbano", "Dungeon"][["wild", "urban", "dungeon"].indexOf(environment)];
      const encounter = table.items.find(item => item.range === roll.toString());
      result = {
        table: `${table.name} (${environmentName})`,
        roll: roll,
        result: encounter[environment],
        timestamp: new Date()
      };
    } else {
      const sides = parseInt(table.dice.replace('d', ''));
      const roll = rollDice(sides);
      const item = table.items.find(item => {
        if (item.range.includes('-')) {
          const [min, max] = item.range.split('-').map(n => parseInt(n));
          return roll >= min && roll <= max;
        }
        return parseInt(item.range) === roll;
      });
      
      result = {
        table: table.name,
        roll: roll,
        range: item.range,
        result: item.result,
        description: item.description || item.features || item.effect,
        timestamp: new Date()
      };
    }
    
    setLastResults(prev => [result, ...prev.slice(0, 9)]);
    setIsRolling(false);
  };

  const rollCompleteNPC = async () => {
    setIsRolling(true);
    await new Promise(resolve => setTimeout(resolve, 1500));
    
    const npcData = tables.npcs;
    const results = {};
    
    // Roll for each component
    npcData.components.forEach(component => {
      const roll = rollDice(component.items.length);
      results[component.name.toLowerCase()] = component.items[roll - 1];
    });
    
    // Generate name from existing table
    const nameRoll = rollDice(100);
    const nameRange = tables.names.items.find(item => {
      const [min, max] = item.range.split('-').map(n => parseInt(n));
      return nameRoll >= min && nameRoll <= (max || min);
    });
    const randomName = nameRange.examples[Math.floor(Math.random() * nameRange.examples.length)];
    
    const npcResult = {
      table: "NPC Completo",
      result: "NPC Gerado",
      npc: {
        nome: randomName,
        raca: nameRange.result,
        profissao: results.profiss√£o,
        aparencia: results.apar√™ncia,
        motivacao: results.motiva√ß√£o,
        segredo: results.segredo
      },
      timestamp: new Date()
    };
    
    setLastResults(prev => [npcResult, ...prev.slice(0, 9)]);
    setIsRolling(false);
  };

  const rollCampaignSeed = async () => {
    setIsRolling(true);
    await new Promise(resolve => setTimeout(resolve, 2000));
    
    // Generate a complete campaign concept
    const themes = ["Guerra civil", "Invas√£o demon√≠aca", "Praga m√≠stica", "Revolu√ß√£o", "Descoberta antiga"];
    const tones = ["√âpico heroico", "Horror c√≥smico", "Intriga pol√≠tica", "Aventura cl√°ssica", "Com√©dia"];
    const twists = ["O vil√£o √© um her√≥i corrompido", "Os PCs s√£o de uma profecia", "O mundo √© uma ilus√£o", 
                   "Os deuses est√£o mortos", "A magia est√° desaparecendo", "Os PCs s√£o o verdadeiro perigo"];
    
    const villainOptions = ["Druida Louco", "Bando de Orcs", "Mago Necromante", "Dem√¥nio Selado", "Culto Sombrio", 
                            "Rei Tirano", "Drag√£o Adormecido", "Golem Descontrolado", "Fera Amaldi√ßoada", "Assassino Fantasma"];
    const villain = villainOptions[rollDice(villainOptions.length) - 1];
    const location1 = tables.locations.items[rollDice(19) - 1].result; // Avoid "combine two" result
    const location2 = tables.locations.items[rollDice(19) - 1].result;
    const treasure = tables.treasures.items[rollDice(12) - 1].result;
    const theme = themes[rollDice(themes.length) - 1];
    const tone = tones[rollDice(tones.length) - 1];
    const twist = twists[rollDice(twists.length) - 1];
    
    const campaignResult = {
      table: "Semente de Campanha",
      result: "Campanha Completa",
      campaign: {
        tema: theme,
        tom: tone,
        vilao_principal: villain,
        local_inicial: location1,
        local_final: location2,
        tesouro_lendario: treasure,
        plot_twist: twist
      },
      timestamp: new Date()
    };
    
    setLastResults(prev => [campaignResult, ...prev.slice(0, 9)]);
    setIsRolling(false);
  };


  const rollQuickAdventure = async () => {
    setIsRolling(true);
    await new Promise(resolve => setTimeout(resolve, 1500));
    
    const villains = ["Druida Louco", "Bando de Orcs", "Mago Necromante", "Dem√¥nio Selado", "Culto Sombrio", 
                     "Rei Tirano", "Drag√£o Adormecido", "Golem Descontrolado", "Fera Amaldi√ßoada", "Assassino Fantasma"];
    const objectives = ["Salvar ref√©ns", "Encontrar tesouro", "Destruir artefato", "Obter informa√ß√£o", "Punir traidor",
                       "Proteger lugar", "Acumular poder", "Fugir de pris√£o", "Consertar erro m√°gico", "Abrir portal"];
    const obstacles = ["Armadilhas", "Monstros", "Enigmas", "Tempo limitado", "Trai√ß√£o", "Magia ca√≥tica",
                      "Clima severo", "Esp√≠ritos", "Pol√≠tica", "Doen√ßa m√°gica"];
    
    const villain = villains[rollDice(10) - 1];
    const location = tables.locations.items[rollDice(19) - 1].result; // Evita o "combine dois"
    const objective = objectives[rollDice(10) - 1];
    const obstacle = obstacles[rollDice(10) - 1];
    const treasure = tables.treasures.items[rollDice(12) - 1].result;
    
    const adventure = {
      table: "Aventura R√°pida",
      result: "Aventura Completa Gerada",
      adventure: {
        villain,
        location,
        objective,
        obstacle, 
        treasure
      },
      timestamp: new Date()
    };
    
    setLastResults(prev => [adventure, ...prev.slice(0, 9)]);
    setIsRolling(false);
  };

  const clearHistory = () => {
    setLastResults([]);
  };

  const copyToClipboard = (text) => {
    navigator.clipboard.writeText(text);
  };

  return (
    <div className="min-h-screen p-4 md:p-8">
      <div className="max-w-7xl mx-auto">
        {/* Header */}
        <motion.div 
          initial={{ opacity: 0, y: -20 }}
          animate={{ opacity: 1, y: 0 }}
          className="text-center mb-8"
        >
          <h1 className="text-4xl font-bold text-text-dark mb-3 tracking-tight">
            üé≤ Gerador Aleat√≥rio Universal
          </h1>
          <p className="text-lg text-medieval-brown mb-4">
            Sistema completo de gera√ß√£o para RPGs - D&D, Pathfinder, OSR e mais!
          </p>
          <div className="flex justify-center gap-2 flex-wrap">
            <Badge className="bg-emerald-100 text-emerald-800">D&D 5.0</Badge>
            <Badge className="bg-amber-100 text-amber-800">D&D 3.5</Badge>
            <Badge className="bg-purple-100 text-purple-800">Pathfinder</Badge>
            <Badge className="bg-blue-100 text-blue-800">OSR</Badge>
            <Badge className="bg-red-100 text-red-800">Universal</Badge>
          </div>
        </motion.div>

        <div className="grid lg:grid-cols-4 gap-6">
          {/* Main Generator */}
          <div className="lg:col-span-3">
            <Tabs value={activeCategory} onValueChange={setActiveCategory}>
              <TabsList className="grid grid-cols-4 lg:grid-cols-8 mb-6 bg-gradient-to-r from-light-gold to-parchment">
                {categories.map(category => {
                  const Icon = category.icon;
                  return (
                    <TabsTrigger 
                      key={category.id}
                      value={category.id}
                      className="data-[state=active]:bg-medieval-gold data-[state=active]:text-text-dark text-sm p-2"
                    >
                      <Icon className="w-4 h-4 mr-1" />
                      <span className="hidden sm:inline">{category.name}</span>
                    </TabsTrigger>
                  );
                })}
              </TabsList>

              {Object.keys(tables).map(tableKey => (
                tableKey !== "npcs" && tableKey !== "weather" && ( // Render regular tables
                  <TabsContent key={tableKey} value={tableKey}>
                    <RandomTableCard
                      table={tables[tableKey]}
                      tableKey={tableKey}
                      onRoll={() => rollOnTable(tableKey)}
                      isRolling={isRolling}
                    />
                  </TabsContent>
                )
              ))}

              <TabsContent value="npcs">
                <NPCGeneratorCard
                  table={tables.npcs}
                  onRoll={rollCompleteNPC}
                  isRolling={isRolling}
                />
              </TabsContent>

              <TabsContent value="weather">
                <RandomTableCard
                  table={tables.weather}
                  tableKey="weather"
                  onRoll={() => rollOnTable("weather")}
                  isRolling={isRolling}
                />
              </TabsContent>

              <TabsContent value="adventures">
                <QuickAdventureGenerator
                  onRoll={rollQuickAdventure}
                  isRolling={isRolling}
                />
              </TabsContent>
            </Tabs>
          </div>

          {/* Results Sidebar */}
          <div className="lg:col-span-1">
            <ResultsHistory
              results={lastResults}
              onClear={clearHistory}
              onCopy={copyToClipboard}
            />
          </div>
        </div>

        {/* Quick Actions */}
        <motion.div 
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.3 }}
          className="mt-8"
        >
          <Card className="medieval-card bg-gradient-to-r from-medieval-gold to-light-gold">
            <CardContent className="p-6">
              <h3 className="text-xl font-bold text-text-dark mb-4 flex items-center gap-2">
                <Sparkles className="w-5 h-5" />
                A√ß√µes R√°pidas
              </h3>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                <Button 
                  onClick={() => rollOnTable("names")}
                  className="medieval-button rounded-lg"
                  disabled={isRolling}
                >
                  <User className="w-4 h-4 mr-2" />
                  Nome R√°pido
                </Button>
                <Button 
                  onClick={() => rollOnTable("locations")}
                  className="medieval-button rounded-lg"
                  disabled={isRolling}
                >
                  <MapPin className="w-4 h-4 mr-2" />
                  Local R√°pido
                </Button>
                <Button 
                  onClick={() => rollOnTable("treasures")}
                  className="medieval-button rounded-lg"
                  disabled={isRolling}
                >
                  <Gem className="w-4 h-4 mr-2" />
                  Tesouro R√°pido
                </Button>
                <Button 
                  onClick={rollQuickAdventure}
                  className="medieval-button rounded-lg"
                  disabled={isRolling}
                >
                  <Scroll className="w-4 h-4 mr-2" />
                  Aventura Completa
                </Button>
              </div>
            </CardContent>
          </Card>
        </motion.div>

        {/* Advanced Generators Section */}
        <motion.div 
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.5 }}
          className="mt-8"
        >
          <Card className="medieval-card bg-gradient-to-r from-purple-600 to-indigo-600 text-white">
            <CardContent className="p-6">
              <h3 className="text-xl font-bold mb-4 flex items-center gap-2">
                <Crown className="w-5 h-5" />
                Geradores Avan√ßados
              </h3>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                <Button 
                  onClick={rollCompleteNPC}
                  className="bg-white text-purple-600 hover:bg-purple-50 rounded-lg p-4 h-auto flex flex-col gap-2"
                  disabled={isRolling}
                >
                  <User className="w-6 h-6" />
                  <span className="font-bold">NPC Completo</span>
                  <span className="text-sm opacity-80">Nome + Profiss√£o + Segredo</span>
                </Button>
                
                <Button 
                  onClick={rollCampaignSeed}
                  className="bg-white text-purple-600 hover:bg-purple-50 rounded-lg p-4 h-auto flex flex-col gap-2"
                  disabled={isRolling}
                >
                  <Crown className="w-6 h-6" />
                  <span className="font-bold">Semente de Campanha</span>
                  <span className="text-sm opacity-80">Tema + Locais + Plot Twist</span>
                </Button>
                
                <Button 
                  onClick={async () => {
                    setIsRolling(true); // Start rolling state for all
                    await new Promise(resolve => setTimeout(resolve, 500));
                    await rollOnTable("weather");
                    await new Promise(resolve => setTimeout(resolve, 500));
                    await rollOnTable("events");
                    await new Promise(resolve => setTimeout(resolve, 500));
                    await rollOnTable("encounters");
                    setIsRolling(false); // End rolling state after all are done
                  }}
                  className="bg-white text-purple-600 hover:bg-purple-50 rounded-lg p-4 h-auto flex flex-col gap-2"
                  disabled={isRolling}
                >
                  <Zap className="w-6 h-6" />
                  <span className="font-bold">Sess√£o R√°pida</span>
                  <span className="text-sm opacity-80">Clima + Evento + Encontro</span>
                </Button>
              </div>
            </CardContent>
          </Card>
        </motion.div>

        {/* Usage Tips */}
        <motion.div 
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.4 }}
          className="mt-6"
        >
          <Card className="border-amber-300 bg-amber-50">
            <CardContent className="p-6">
              <h4 className="font-bold text-amber-800 mb-3">üí° Como Usar o Gerador</h4>
              <div className="grid md:grid-cols-3 gap-4 text-sm text-amber-700">
                <div>
                  <h5 className="font-semibold mb-2">Para Mestres:</h5>
                  <ul className="space-y-1">
                    <li>‚Ä¢ Use antes da sess√£o para preparar</li>
                    <li>‚Ä¢ Role durante o jogo para improvisar</li>
                    <li>‚Ä¢ Combine tabelas para hist√≥rias completas</li>
                  </ul>
                </div>
                <div>
                  <h5 className="font-semibold mb-2">Para Jogadores:</h5>
                  <ul className="space-y-1">
                    <li>‚Ä¢ Gere nomes para personagens</li>
                    <li>‚Ä¢ Crie hist√≥rico com personalidade</li>
                    <li>‚Ä¢ Invente NPCs e aliados</li>
                  </ul>
                </div>
                <div>
                  <h5 className="font-semibold mb-2">Cria√ß√£o de Mundos:</h5>
                  <ul className="space-y-1">
                    <li>‚Ä¢ Gere regi√£o: 3 locais + 2 tesouros</li>
                    <li>‚Ä¢ Adicione 1 ru√≠na + 1 evento</li>
                    <li>‚Ä¢ Pronto: √°rea de aventura!</li>
                  </ul>
                </div>
              </div>
            </CardContent>
          </Card>
        </motion.div>
      </div>
    </div>
  );
}
